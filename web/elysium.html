<!DOCTYPE html>
<html lang="en" class="dark-mode" data-accent="purple">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elysium Client - GUI</title>
    <script type="text/javascript" src="/eel.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- Base Theme (Unchanged) --- */
        :root {--primary-hue: 260; --primary-sat: 85%; --primary: hsl(var(--primary-hue), var(--primary-sat), 65%); --primary-dark: hsl(var(--primary-hue), 65%, 45%); --bg-space: hsl(var(--primary-hue), 60%, 8%); --bg-main: hsla(var(--primary-hue), 55%, 12%, 0.85); --border-color: hsla(var(--primary-hue), 50%, 50%, 0.4); --module-bg: hsla(var(--primary-hue), 40%, 15%, 0.4); --input-bg: hsla(var(--primary-hue), 40%, 15%, 0.6); --text-main: #e8e8e8; --text-dark: #1f2937; --border-gradient: linear-gradient(to bottom right, var(--primary-dark), var(--primary));}
        html.dark-mode { --text-main: #e8e8e8; }
        html.light-mode { --text-main: #1f2937; --bg-space: hsl(var(--primary-hue), 25%, 98%); --bg-main: hsla(var(--primary-hue), 40%, 96%, 0.85); --module-bg: hsla(var(--primary-hue), 30%, 100%, 0.6); --input-bg: hsla(var(--primary-hue), 30%, 92%, 1); --border-color: hsla(var(--primary-hue), 40%, 50%, 0.5); }
        html[data-accent="purple"] { --primary-hue: 260; } html[data-accent="red"] { --primary-hue: 0; } html[data-accent="blue"] { --primary-hue: 217; } html[data-accent="pink"] { --primary-hue: 320; } html[data-accent="green"] { --primary-hue: 140; } html[data-accent="orange"] { --primary-hue: 28; }
        
        /* --- Animated Background (Unchanged) --- */
        #dynamic-background { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -2; overflow: hidden; pointer-events: none; }
        #mouse-spotlight { position: fixed; width: 600px; height: 600px; border-radius: 50%; background: radial-gradient(circle, hsla(var(--primary-hue), var(--primary-sat), 70%, 0.15) 0%, transparent 60%); pointer-events: none; transition: opacity 0.3s ease, transform 0.1s linear; transform: translate(-50%, -50%); opacity: 0; z-index: -1; }
        .main-container:hover ~ #mouse-spotlight { opacity: 1; }
        .aurora-layer { position: absolute; width: 100vw; height: 100vh; background: radial-gradient(circle, var(--primary) 0, transparent 60%); transition: background 0.5s ease; animation-duration: 25s; animation-timing-function: linear; animation-iteration-count: infinite; animation-direction: alternate; }
        #aurora-1 { opacity: 0.20; animation-name: aurora-one; } #aurora-2 { opacity: 0.15; animation-name: aurora-two; animation-direction: alternate-reverse; animation-duration: 30s; } #aurora-3 { opacity: 0.18; animation-name: aurora-three; animation-duration: 35s; }
        @keyframes aurora-one { from { transform: rotate(0deg) translateX(20vw) scale(1.2); } to { transform: rotate(360deg) translateX(20vw) scale(1.2); } }
        @keyframes aurora-two { from { transform: rotate(45deg) translateX(-15vw) scale(1.1); } to { transform: rotate(405deg) translateX(-15vw) scale(1.1); } }
        @keyframes aurora-three { from { transform: rotate(-45deg) translateY(10vw) scale(1.4); } to { transform: rotate(315deg) translateY(10vw) scale(1.4); } }
        .shooting-star { position: absolute; width: 3px; height: 80px; background: linear-gradient(to top, var(--primary), transparent); opacity: 0; animation: star-fall 3s linear; }
        @keyframes star-fall { 0% { opacity: 1; transform: translateY(-100px) rotate(-45deg); } 100% { opacity: 0; transform: translateY(calc(100vh + 100px)) rotate(-45deg); } }
        
        /* --- General Layout & Font Styles (Unchanged) --- */
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg-space); color: var(--text-main); overflow: hidden; transition: color 0.3s ease, background-color 0.3s ease; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .main-container { background-color: var(--bg-main); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); max-height: 95vh; transition: all 0.3s ease; border: 2px solid transparent; background-clip: padding-box; border-image: var(--border-gradient); border-image-slice: 1; position: relative; z-index: 1; }
        .text-glow { color: var(--primary); transition: all 0.3s ease; text-shadow: 0 0 8px var(--primary), 0 0 16px hsla(var(--primary-hue), var(--primary-sat), 50%, 0.5); }
        .tab-content { animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Scrollbar & Nav Styling (Unchanged) --- */
        main::-webkit-scrollbar, #log-container::-webkit-scrollbar, .modal-body::-webkit-scrollbar, #server-list-container::-webkit-scrollbar, #calibration-image-container::-webkit-scrollbar { width: 10px; }
        main::-webkit-scrollbar-track, #log-container::-webkit-scrollbar-track, .modal-body::-webkit-scrollbar-track, #server-list-container::-webkit-scrollbar-track, #calibration-image-container::-webkit-scrollbar-track { background: transparent; }
        main::-webkit-scrollbar-thumb, #log-container::-webkit-scrollbar-thumb, .modal-body::-webkit-scrollbar-thumb, #server-list-container::-webkit-scrollbar-thumb, #calibration-image-container::-webkit-scrollbar-thumb { background-color: var(--primary); border-radius: 20px; border: 2px solid transparent; background-clip: content-box; }
        main::-webkit-scrollbar-thumb:hover, #log-container::-webkit-scrollbar-thumb:hover, .modal-body::-webkit-scrollbar-thumb:hover, #server-list-container::-webkit-scrollbar-thumb:hover, #calibration-image-container::-webkit-scrollbar-thumb:hover { background-color: var(--primary-dark); }
        .nav-button { transition: all 0.2s ease-in-out; border-left: 3px solid transparent; color: var(--text-main); opacity: 0.6; }
        .nav-button.active { border-left-color: var(--primary); color: var(--text-main); opacity: 1; }
        .nav-button:hover:not(.active) { opacity: 1; border-left-color: var(--border-color); }
        
        /* --- NEW: Module Hover Effect --- */
        .module { 
            background-color: var(--module-bg); 
            border: 1px solid var(--border-color); 
            border-radius: 0.75rem; 
            box-shadow: 0 4px 12px -4px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .module:hover {
            transform: translateY(-5px); 
            box-shadow: 0 10px 25px -5px hsla(var(--primary-hue), var(--primary-sat), 50%, 0.3); 
        }

        /* --- Inputs & Toggles (Unchanged) --- */
        .setting-input { background-color: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-main); padding: 0.5rem; border-radius: 0.375rem; }
        .custom-select { background-color: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-main); padding: 0.5rem; border-radius: 0.375rem; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23a855f7' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .custom-select:hover, .setting-input:hover { border-color: var(--primary); }
        .custom-select:focus, .setting-input:focus { outline: none; box-shadow: 0 0 8px -2px var(--primary); }
        .custom-select:disabled { opacity: 0.5; cursor: not-allowed; }
        .toggle-label { transition: background-color 0.2s ease-in-out; background-color: hsla(var(--primary-hue), 10%, 30%, 0.5); }
        .toggle-ball { transition: transform 0.2s ease-in-out; }
        .toggle-checkbox:checked + .toggle-label { background-color: var(--primary); }
        .toggle-checkbox:checked + .toggle-label .toggle-ball { transform: translateX(1.25rem); }

        /* --- Buttons --- */
        .btn-primary { background-color: var(--primary); border: 1px solid transparent; color: #fff; transition: all 0.2s ease; padding: 0.5rem 1rem; }
        .btn-primary:hover { background-color: var(--primary-dark); filter: drop-shadow(0 0 8px var(--primary));}
        .btn-green { background-color: #16a34a; transition: all 0.2s ease; } .btn-green:hover:not(:disabled) { background-color: #22c55e; transform: scale(1.03); filter: drop-shadow(0 0 8px #22c55e);}
        .btn-green:disabled { background-color: #4b5563; cursor: not-allowed; opacity: 0.7; }
        
        .btn-calibrate {
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0.6rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid transparent;
            box-shadow: 0 2px 10px -2px var(--primary-dark);
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 0.5rem;
        }
        .btn-calibrate:hover:not(:disabled) {
            transform: scale(1.02);
            filter: brightness(1.2);
            box-shadow: 0 4px 20px -2px var(--primary);
        }
        .btn-calibrate:disabled {
            background: #4b5563;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
            filter: none;
            box-shadow: none;
        }

        /* --- NEW: Discord Button --- */
        .discord-button {
            background-color: #5865F2; /* Discord Blurple */
            color: #FFFFFF;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            font-size: 1rem; /* 16px */
            padding: 0.75rem; /* 12px */
            border-radius: 0.5rem; /* 8px */
            text-decoration: none;
            display: flex; /* To align icon and text */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Space between icon and text */
            margin-top: 1.5rem; /* 24px, space from nav links */
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 12px -4px rgba(88, 101, 242, 0.4);
        }
        .discord-button:hover {
            background-color: #4752C4;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px -4px rgba(88, 101, 242, 0.5);
        }
        .discord-button svg {
            width: 1.5rem; /* 24px */
            height: 1.5rem; /* 24px */
        }

        /* --- Misc & Modals (Mostly Unchanged) --- */
        .server-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; border-radius: 0.5rem; border: 2px solid transparent; cursor: pointer; transition: all 0.2s ease; position: relative; }
        .server-item:hover { background-color: hsla(var(--primary-hue), 50%, 50%, 0.1); }
        .server-item.active { border-color: var(--primary); background-color: hsla(var(--primary-hue), 50%, 50%, 0.2); }
        .server-icon { width: 48px; height: 48px; border-radius: 0.25rem; background-color: rgba(0,0,0,0.5); image-rendering: pixelated; flex-shrink: 0; }
        .copied-tooltip { position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background-color: var(--primary); color: white; padding: 2px 8px; border-radius: 0.5rem; font-size: 0.75rem; font-weight: bold; pointer-events: none; opacity: 0; transition: opacity 0.3s ease; }
        .server-item.show-tooltip .copied-tooltip { opacity: 1; }
        #calibration-modal { backdrop-filter: blur(8px); }
        #calibration-canvas { cursor: crosshair; }
        #calibration-image-container { position: relative; border: 2px solid var(--primary); box-shadow: 0 0 20px 5px var(--primary); max-width: 90vw; max-height: 80vh; overflow: auto;}
        
        #copy-log-btn { position: relative; }
        .log-copy-tooltip { 
            position: absolute; 
            bottom: 120%;
            left: 50%; 
            transform: translateX(-50%);
            background-color: var(--primary); 
            color: white; 
            padding: 4px 10px; 
            border-radius: 0.5rem; 
            font-size: 0.75rem; 
            font-weight: bold; 
            pointer-events: none;
            opacity: 0; 
            transition: opacity 0.3s ease, bottom 0.3s ease; 
            white-space: nowrap;
        }
        #copy-log-btn.show-tooltip .log-copy-tooltip { 
            opacity: 1; 
            bottom: 130%;
        }
    </style>
</head>
<body>
    <div id="dynamic-background"><div id="aurora-1" class="aurora-layer"></div><div id="aurora-2" class="aurora-layer"></div><div id="aurora-3" class="aurora-layer"></div></div>
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="main-container w-[850px] rounded-2xl flex flex-col shadow-2xl">
            <div class="flex flex-1 overflow-hidden">
                <nav class="w-60 border-r p-4 flex flex-col flex-shrink-0" style="border-color: var(--border-color);">
                    <div class="text-center py-4 mb-6"><h1 class="text-4xl font-orbitron font-bold text-glow">ELYSIUM</h1></div>
                    <ul class="space-y-2">
                        <li><button data-tab="combat" class="nav-button active w-full flex items-center gap-3 p-3 rounded-lg text-lg font-orbitron">Combat</button></li>
                        <li><button data-tab="info" class="nav-button w-full flex items-center gap-3 p-3 rounded-lg text-lg font-orbitron">Info</button></li>
                        <li><button data-tab="settings" class="nav-button w-full flex items-center gap-3 p-3 rounded-lg text-lg font-orbitron">Settings</button></li>
                    </ul>
                    <a href="https://discord.gg/mAjh39EWYM" target="_blank" class="discord-button">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.36981C18.7915 3.72559 17.1858 3.2841 15.5245 3.07689C15.4223 3.36238 15.3323 3.63943 15.2544 3.90812C13.599 3.63943 11.9933 3.63943 10.3876 3.90812C10.3097 3.63943 10.2197 3.36238 10.1175 3.07689C8.45625 3.2841 6.85054 3.71714 5.32509 4.36981C1.55621 9.13116 0.88414 13.6392 1.22384 17.9757C2.94437 19.0488 4.79374 19.7831 6.66683 20.2801C7.03432 19.7406 7.37812 19.1685 7.69819 18.5638C6.91851 18.2524 6.16256 17.8983 5.43825 17.5015C5.6133 17.2933 5.78835 17.0765 5.95494 16.8512C9.25699 18.2393 12.8392 18.2393 16.1174 16.8512C16.284 17.0765 16.459 17.2933 16.6341 17.5015C15.9098 17.8983 15.1538 18.2524 14.3741 18.5638C14.6942 19.1685 15.038 19.7406 15.4055 20.2801C17.2786 19.7831 19.128 19.0488 20.8485 17.9757C21.2294 13.3852 20.4284 8.9242 16.7118 4.57724L20.317 4.36981ZM8.68132 15.176C7.99446 15.176 7.42239 14.542 7.42239 13.7859C7.42239 13.0298 7.99446 12.3958 8.68132 12.3958C9.36819 12.3958 9.94025 13.0298 9.92798 13.7859C9.92798 14.542 9.36819 15.176 8.68132 15.176ZM13.4357 15.176C12.7488 15.176 12.1767 14.542 12.1767 13.7859C12.1767 13.0298 12.7488 12.3958 13.4357 12.3958C14.1225 12.3958 14.6946 13.0298 14.6823 13.7859C14.6823 14.542 14.1225 15.176 13.4357 15.176Z"></path></svg>
                        <span>Join Discord</span>
                    </a>
                    <div class="mt-auto text-center text-xs" style="color: var(--text-main); opacity: 0.5;"><span id="build-date"></span></div>
                </nav>
                <main class="flex-1 p-6 overflow-y-auto">
                    <div id="combat" class="tab-content">
                        <h2 class="text-3xl font-orbitron font-bold mb-2">Combat Modules</h2>
                        <p class="text-sm text-center opacity-70 mb-6 italic" style="color: var(--primary);">Turn all modules on before running calibration.</p>
                        <div id="combat-modules-container" class="space-y-6"></div>
                    </div>
                    <div id="info" class="tab-content hidden">
                        <h2 class="text-3xl font-orbitron font-bold mb-6">Information & Credits</h2>
                        <div class="p-6 module space-y-6 text-base leading-relaxed">
                            <div>
                                <h3 class="font-semibold text-xl mb-2 text-glow">Made By</h3>
                                <p class="opacity-80">Xenospardie, xeno, trinity, itzrealde, and crysium</p>
                            </div>
                            <div class="border-t pt-6" style="border-color: var(--border-color);">
                                <h3 class="font-semibold text-xl mb-2 text-glow">My Story</h3>
                                <p class="opacity-80 mb-4">
                                    My story started two summers ago when I began streaming the Donut SMP. I was dedicated, staying up all night streaming from 7 PM to 8 o'clock in the morning. After streaming, I'd go to my cousin's house, sleep all day, and get right back to it. The hard work paid off, and I was so happy when I finally hit 800 subscribers.
                                </p>
                                <p class="opacity-80 mb-4">
                                    Then, disaster struck. I was banned from YouTube for a copyright issue. I had to make a new account and start all over. I managed to get back to 300 subscribers, a long way from my original 800.
                                </p>
                                <p class="opacity-80 mb-4">
                                    Things got worse when I was banned from the Donut SMP itself. A player named Cloak falsely accused me of doxxing him by posting a GIF of his face. Even after he admitted he was wrong and apologized, the staff didn't care and the ban stood. I tried to get back by using alts, but it was a struggle.
                                </p>
                                <p class="opacity-80">
                                    I started over once more with a new YouTube channel. I climbed back to 400 subscribers, earned the media rank, and was even raided by Donut. But then, I was banned again. Through all this, I've come to believe that DrDonut might be a good person, but the staff is the real issue and it needs to be changed. I decided that this project might be a way to stop their toxic reign of terror in the community by bringing its problems to light.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div id="settings" class="tab-content hidden"><h2 class="text-3xl font-orbitron font-bold mb-6">Client Settings</h2><div class="p-4 module space-y-6"><div><h3 class="font-semibold text-lg mb-3 text-center">Theme</h3><div class="flex justify-center items-center gap-4"><button data-mode="dark-mode" class="mode-button active">Dark</button><button data-mode="light-mode" class="mode-button">Light</button></div></div><div class="border-t my-4" style="border-color: var(--border-color);"></div><div><h3 class="font-semibold text-lg mb-3 text-center">Accent Color</h3><div class="flex justify-center items-center gap-5 py-2"><button data-accent="purple" class="theme-button active h-10 w-10 rounded-full" style="background-color: #a855f7;"></button><button data-accent="red" class="theme-button h-10 w-10 rounded-full" style="background-color: #ef4444;"></button><button data-accent="blue" class="theme-button h-10 w-10 rounded-full" style="background-color: #3b82f6;"></button><button data-accent="pink" class="theme-button h-10 w-10 rounded-full" style="background-color: #ec4899;"></button><button data-accent="green" class="theme-button h-10 w-10 rounded-full" style="background-color: #22c55e;"></button><button data-accent="orange" class="theme-button h-10 w-10 rounded-full" style="background-color: #f97316;"></button></div></div></div></div>
                </main>
            </div>
            <div class="m-4 mt-0 p-4 border-t" style="border-color: var(--border-color);">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-orbitron" style="color: var(--primary);">EVENT LOG</h3>
                    <button id="copy-log-btn" class="p-1.5 rounded-md hover:bg-white/10 transition-colors" title="Copy Log to Clipboard">
                        <span class="log-copy-tooltip">Copied!</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" /><path d="M4 3a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V5a2 2 0 00-2-2H4z" /></svg>
                    </button>
                </div>
                <div id="log-container" class="h-[140px] bg-black/50 rounded-lg p-2 overflow-y-auto flex flex-col-reverse"></div>
            </div>
        </div>
        <div id="mouse-spotlight"></div>
    </div>
    <div id="mods-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden"><div id="modal-backdrop" class="fixed inset-0 bg-black/60 backdrop-blur-sm"></div><div class="relative module w-full max-w-lg mx-4"><div class="flex justify-between items-center p-4 border-b" style="border-color: var(--border-color);"><h3 class="text-2xl font-orbitron font-bold">Client Mods</h3><button id="close-mods-modal-btn" class="p-1 rounded-full hover:bg-white/10 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><div class="p-4 max-h-[60vh] overflow-y-auto modal-body" id="mods-list-container"></div></div></div>
    <div id="calibration-modal" class="fixed inset-0 z-50 flex-col items-center justify-center hidden bg-black/80">
        <div id="calibration-instructions" class="p-4 mb-4 text-2xl font-orbitron text-white rounded-lg" style="background-color: var(--primary);">Loading...</div>
        <div id="calibration-image-container"><img id="calibration-screenshot" src="" alt="Calibration Screenshot" class="select-none" /><canvas id="calibration-canvas" class="absolute top-0 left-0"></canvas></div>
        <button id="cancel-calibration-btn" class="mt-4 px-6 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors">Cancel</button>
    </div>

    <script>
        // --- ALL ORIGINAL JAVASCRIPT IS PRESERVED ---
        // I have only made two small changes, marked with 'MODIFIED' comments.

        window.discoveredProfiles = [];

        async function buildGui() {
            const data = await eel.get_initial_data()();
            if (!data || !data.modules) { add_log_entry("⚠️ Client Error: Could not load module data."); return; }
            window.loaded_modules = data.modules;
            const containers = { combat: document.getElementById('combat-modules-container'), client_mod: document.getElementById('mods-list-container') };
            Object.values(containers).forEach(c => { if(c) c.innerHTML = ''; });
            for (const internal_name in data.modules) {
                const module = data.modules[internal_name];
                const category = module.category || 'combat';
                const targetContainer = containers[category];
                if (!targetContainer) continue;
                if (category === 'combat') {
                    let settingsHtml = '';
                    if(module.settings) {
                        for (const key in module.settings) {
                            const setting = module.settings[key];
                            const label = setting.name || key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            const inputType = (key.includes('bind') || key.includes('key')) ? 'text' : 'number';
                            const inputHtml = `<div class="space-y-1"><label class="text-sm font-semibold flex items-center">${label}</label><input type="${inputType}" step="0.01" id="${internal_name}-${key}" class="w-full p-1 rounded setting-input text-center" value="${setting.default}"></div>`;
                            settingsHtml += inputHtml;
                        }
                    }
                    let calibrationHtml = '';
                    // --- MODIFIED: Use the new .btn-calibrate class ---
                    if (module.has_calibration) { calibrationHtml += `<button onclick="runModuleCalibration('${internal_name}')" class="btn-calibrate">Calibrate</button>`; }
                    // This lag calibration button remains as a smaller, secondary button.
                    if (module.has_lag_calibration) { calibrationHtml += `<button onclick="runLagCalibration('${internal_name}')" class="w-full btn-primary font-bold mt-2 text-sm py-1">Auto-Tune Lag</button>`; }
                    
                    targetContainer.innerHTML += `<div class="module"><div class="module-title p-4 flex justify-between items-center"><div><h3 class="text-xl font-semibold font-orbitron">${module.name}</h3><p class="text-sm opacity-70">${module.description}</p></div><div class="flex items-center"><input type="checkbox" id="toggle-${internal_name}" class="toggle-checkbox hidden module-toggle"/><label for="toggle-${internal_name}" class="toggle-label flex items-center cursor-pointer w-12 h-6 rounded-full p-1"><div class="toggle-ball w-4 h-4 bg-white rounded-full shadow-md transform"></div></label></div></div><div class="p-4 border-t" style="border-color: var(--border-color);"><div class="grid grid-cols-2 gap-4">${settingsHtml}<div class="col-span-2 pt-2">${calibrationHtml}</div></div></div></div>`;
                }
            }
            addEventListeners();
        }

        async function addEventListeners() {
            document.querySelectorAll('.nav-button').forEach(button => { button.addEventListener('click', () => { document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden')); document.getElementById(button.dataset.tab).classList.remove('hidden'); }); });
            document.querySelectorAll('.mode-button').forEach(button => { button.addEventListener('click', async () => { const mode = button.dataset.mode; document.documentElement.classList.remove('dark-mode', 'light-mode'); document.documentElement.classList.add(mode); document.querySelectorAll('.mode-button').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); await eel.update_client_setting('mode', mode)(); }); });
            document.querySelectorAll('.theme-button').forEach(button => { button.addEventListener('click', async () => { const accent = button.dataset.accent; document.documentElement.dataset.accent = accent; document.querySelectorAll('.theme-button').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); await eel.update_client_setting('accent', accent)(); }); });
            document.querySelectorAll('.setting-input').forEach(input => { input.addEventListener('change', async () => { const [module, key] = input.id.split('-'); await eel.update_setting(module, key, input.value)(); }); });
            document.querySelectorAll('.module-toggle').forEach(toggle => { toggle.addEventListener('change', async () => { const module_name = toggle.id.replace('toggle-', ''); await eel.toggle_module(module_name, toggle.checked)(); }); });
            const modal = document.getElementById('mods-modal'), openBtn = document.getElementById('open-mods-modal-btn'), closeBtn = document.getElementById('close-mods-modal-btn'), backdrop = document.getElementById('modal-backdrop');
            openBtn?.addEventListener('click', () => modal.classList.remove('hidden'));
            closeBtn?.addEventListener('click', () => modal.classList.add('hidden'));
            backdrop?.addEventListener('click', () => modal.classList.add('hidden'));
            document.addEventListener('keydown', (e) => { if (e.key === "Escape" && !modal.classList.contains('hidden')) { modal.classList.add('hidden'); } });
            document.getElementById('copy-log-btn').addEventListener('click', copyLog);
        }
        
        eel.expose(add_log_entry); function add_log_entry(message) { const logContainer = document.getElementById('log-container'); const timestamp = new Date().toLocaleTimeString('en-US',{hour12:true, hour:'numeric',minute:'2-digit',second:'2-digit'}); const entry = document.createElement('div'); entry.className = 'log-entry p-1 text-sm'; entry.innerHTML = `<span class="opacity-60 mr-2">[${timestamp}]</span> ${message}`; logContainer.prepend(entry); }
        eel.expose(finish_apply_task); function finish_apply_task() { const btn = document.getElementById('apply-relaunch-btn'); if(btn) { btn.disabled = false; btn.textContent = 'Apply Mods & Launch';} }
        eel.expose(set_toggle_state); function set_toggle_state(module_name, is_enabled) { const toggle = document.getElementById(`toggle-${module_name}`); if (toggle) { toggle.checked = is_enabled; } }
        eel.expose(set_setting_value); function set_setting_value(module_name, key, value) { const input = document.getElementById(`${module_name}-${key}`); if (input) { input.value = value; } }
        eel.expose(set_client_setting); function set_client_setting(key, value) { if (key === 'mode') { document.documentElement.classList.remove('dark-mode', 'light-mode'); document.documentElement.classList.add(value); document.querySelectorAll('.mode-button').forEach(btn => btn.classList.toggle('active', btn.dataset.mode === value)); } else if (key === 'accent') { document.documentElement.dataset.accent = value; document.querySelectorAll('.theme-button').forEach(btn => btn.classList.toggle('active', btn.dataset.accent === value)); } }
        eel.expose(update_profile_list); function update_profile_list(profiles) { /* Placeholder */ }
        eel.expose(update_server_list); function update_server_list(servers) { /* Placeholder */ }

        // --- MODIFIED: Added tooltip logic to the existing copy function ---
        function copyLog() {
            const logContainer = document.getElementById('log-container');
            const logText = Array.from(logContainer.children).map(entry => entry.innerText).reverse().join('\n');
            navigator.clipboard.writeText(logText).then(() => {
                // On success, show the tooltip
                const btn = document.getElementById('copy-log-btn');
                btn.classList.add('show-tooltip');
                // Hide the tooltip after a short delay
                setTimeout(() => { btn.classList.remove('show-tooltip'); }, 1500);
            }, (err) => {
                add_log_entry('❌ Failed to copy log: ' + err);
            });
        }

        async function runModuleCalibration(module_name) { add_log_entry(`Starting calibration for ${module_name}...`); await eel.run_module_calibration(module_name, 'default')(); }
        async function runLagCalibration(module_name) { add_log_entry(`Starting lag calibration for ${module_name}...`); await eel.run_module_calibration(module_name, 'lag')(); }

        const calib = { moduleName: null, fields: [], currentIndex: 0, data: {}, baseScreenshot: null, canvas: null, ctx: null, img: null, modal: null, instructions: null, isDrawing: false, startX: 0, startY: 0, scaleX: 1, scaleY: 1 };
        function initCalibrationElements() { calib.modal = document.getElementById('calibration-modal'); calib.img = document.getElementById('calibration-screenshot'); calib.canvas = document.getElementById('calibration-canvas'); calib.ctx = calib.canvas.getContext('2d'); calib.instructions = document.getElementById('calibration-instructions'); document.getElementById('cancel-calibration-btn').onclick = cancelCalibration; }
        eel.expose(start_calibration_gui);
        async function start_calibration_gui(moduleName, img_str, original_dims) { initCalibrationElements(); calib.moduleName = moduleName; calib.baseScreenshot = img_str; calib.data = {}; calib.img.onload = async () => { calib.modal.classList.remove('hidden'); calib.modal.classList.add('flex'); calib.canvas.width = calib.img.clientWidth; calib.canvas.height = calib.img.clientHeight; calib.scaleX = original_dims[0] / calib.canvas.width; calib.scaleY = original_dims[1] / calib.canvas.height; try { calib.fields = await eel.get_calibration_fields(module_name)(); if (!calib.fields || calib.fields.length === 0) throw new Error("No calibration fields found."); calib.currentIndex = 0; setupCanvasListeners(); promptNextField(); } catch (error) { add_log_entry(`❌ Calibration error: ${error.message}`); cancelCalibration(); } }; calib.img.src = `data:image/png;base64,${img_str}`; }
        function promptNextField() { if (calib.currentIndex >= calib.fields.length) { finishCalibration(); return; } const field = calib.fields[calib.currentIndex]; calib.instructions.textContent = `Step ${calib.currentIndex + 1}/${calib.fields.length}: ${field.description}`; }
        function setupCanvasListeners() { calib.canvas.onmousedown = (e) => { calib.isDrawing = true; calib.startX = e.offsetX; calib.startY = e.offsetY; }; calib.canvas.onmousemove = (e) => { if (!calib.isDrawing) return; calib.ctx.clearRect(0, 0, calib.canvas.width, calib.canvas.height); calib.ctx.strokeStyle = 'rgba(255, 0, 0, 0.9)'; calib.ctx.lineWidth = 2; calib.ctx.strokeRect(calib.startX, calib.startY, e.offsetX - calib.startX, e.offsetY - calib.startY); }; calib.canvas.onmouseup = async (e) => { if (!calib.isDrawing) return; calib.isDrawing = false; const x1 = Math.min(calib.startX, e.offsetX) * calib.scaleX; const y1 = Math.min(calib.startY, e.offsetY) * calib.scaleY; const x2 = Math.max(calib.startX, e.offsetX) * calib.scaleX; const y2 = Math.max(calib.startY, e.offsetY) * calib.scaleY; const coords = [x1, y1, x2, y2]; const currentField = calib.fields[calib.currentIndex]; const result = await eel.process_calibration_selection(calib.moduleName, currentField.key, coords, calib.baseScreenshot)(); if(result) { calib.data[currentField.key] = result; calib.currentIndex++; promptNextField(); } else { add_log_entry(`❌ Failed to process selection. Please try again.`); } calib.ctx.clearRect(0, 0, calib.canvas.width, calib.canvas.height); }; }
        async function finishCalibration() { await eel.save_full_calibration(calib.moduleName, calib.data)(); cancelCalibration(); }
        function cancelCalibration() { calib.modal.classList.add('hidden'); calib.modal.classList.remove('flex'); calib.img.src = ""; if (calib.ctx) { calib.ctx.clearRect(0, 0, calib.canvas.width, calib.canvas.height); } calib.canvas.onmousedown = null; calib.canvas.onmousemove = null; calib.canvas.onmouseup = null; }
        
        document.addEventListener('DOMContentLoaded', async () => { 
            // The functionality for the launcher and mods tab has been removed, so we remove the related JS logic.
            // The rest of the initialization logic is preserved.
            document.getElementById('build-date').textContent = `Build: ${new Date().toLocaleDateString()}`; 
            await buildGui(); 
            setInterval(async () => { await eel.check_calibration_queue()(); }, 100); 
            const spotlight = document.getElementById('mouse-spotlight'); 
            document.addEventListener('mousemove', (e) => { spotlight.style.left = `${e.clientX}px`; spotlight.style.top = `${e.clientY}px`; }); 
            const background = document.getElementById('dynamic-background'); 
            const createShootingStar = () => { const star = document.createElement('div'); star.className = 'shooting-star'; star.style.left = `${Math.random() * 100}vw`; star.style.animationDuration = `${2 + Math.random() * 3}s`; star.style.animationDelay = `${Math.random() * 5}s`; background.appendChild(star); setTimeout(() => star.remove(), 8000); }; 
            for(let i=0; i<5; i++) createShootingStar(); setInterval(createShootingStar, 2500); 
        });
    </script>
</body>
</html>
